:: Widgets Tentacles [widget]
<<widget "tentaclestart">>
	<<if $abomination isnot 1>>
		<<set $enemyarousalmax to 10000>>
	<</if>>

	<<set $tentacles to {
		"max": _args[0],
		"active": _args[0],
	}>>

	<<if _args[0]>>

		<<if _args[2]>>
			<<set _tentacleType to _args[2]>>
		<<else>>
			<<set _tentacleType to "tentacle">>
		<</if>>
		<<if ["root","shoot"].includes(_tentacleType)>>
			<<set _babyType to "vine">>
		<<elseif _tentacleType is "tendril">>
			<<set _babyType to "tentacle">>
		<<else>>
			<<set _babyType to _tentacleType>>
		<</if>>
		<<if ["root","shoot","vine","metal"].includes(_tentacleType) or _args[3] is "metal">>
			<<set $banishDisable to true>>
		<</if>>

		/* Deciding if tentacle templates should be defined somewhere else still */
		/* Argument 0 is the number of tentacles.
		* Argument 1 is health.
		* Argument 2 is tentacle type, which can be replaced with "vines", "machines" etc later on. Optional, unless also using Argument 3.
		* Argument 3 is variant, and will give different offspring as well as allowing different batches of descriptions.
		* Argument 4 is whether or not the variant impacts the full description and offspring. If Argument 4 is used, Argument 3 will only impact which description batches are part of _tentacledescs. If Argument 4 is "desc", Argument 3 will impact description batches and variant, but not offspring.*/
		<<set _tentacledescs to [
			{"desc":"粘腻的","baby":0,"size":2,"traits":[]},
			{"desc":"粘稠的","baby":0,"size":2,"traits":[]},
			{"desc":"粗壮的","baby":_babyType,"size":3,"traits":[]},
			{"desc":"脉动的","baby":0,"size":2,"traits":[]},
			{"desc":"滑溜的","baby":0,"size":2,"traits":[]},
			{"desc":"湿润的","baby":0,"size":2,"traits":[]},
			{"desc":"抖动的","baby":0,"size":2,"traits":[]},
			{"desc":"潮湿的","baby":0,"size":2,"traits":[]},
			{"desc":"颤抖的","baby":0,"size":2,"traits":[]},
			{"desc":"震颤的","baby":0,"size":2,"traits":[]},
			{"desc":"颤动的","baby":0,"size":2,"traits":["hypno"]},
			{"desc":"波浪状的","baby":0,"size":2,"traits":[]},
			{"desc":"濡湿的","baby":0,"size":2,"traits":[]},
			{"desc":"肥大的","baby":0,"size":3,"traits":[]},
			{"desc":"螺旋的","baby":0,"size":2,"traits":[]},
			{"desc":"巨大的","baby":_babyType,"size":3,"traits":[]},
			{"desc":"凹凸的","baby":0,"size":2,"traits":[]},
			{"desc":"细小的","baby":0,"size":1,"traits":[]},
			{"desc":"狭窄的","baby":0,"size":1,"traits":[]},
			{"desc":"湿软的","baby":0,"size":2,"traits":[]},
			{"desc":"粗糙的","baby":0,"size":2,"traits":["pain"]},
		]>>

		<<if _args[3]>>
			<<if _args[3] is "pale">>
				<<set _tentacledescs.push(
					{"desc":"奇异的","baby":_babyType,"size":2,"traits":[]},
					{"desc":"半透明的","baby":0,"size":1,"traits":["hypno"]},
					{"desc":"颤搐的","baby":0,"size":2,"traits":[]},
					{"desc":"狂热的","baby":0,"size":3,"traits":[]},
					{"desc":"浑浊的","baby":_babyType,"size":3,"traits":[]},
					{"desc":"飘逸的","baby":0,"size":1,"traits":[]},
					{"desc":"发光的","baby":0,"size":3,"traits":["hypno"]},
					{"desc":"斑斓的","baby":_babyType,"size":2,"traits":["hypno"]},
					{"desc":"灼热的","baby":0,"size":3,"traits":["pain"]},
				)>>
			<<elseif _args[3] is "vine">>
				<<set _tentacledescs.push(
					{"desc":"开花的","baby":_babyType,"size":3,"traits":[]},
					{"desc":"绽放的","baby":0,"size":3,"traits":[]},
					{"desc":"木质的","baby":0,"size":2,"traits":[]},
					{"desc":"盛开的","baby":_babyType,"size":2,"traits":["hypno"]},
					{"desc":"盘绕的","baby":0,"size":2,"traits":[]},
					{"desc":"长苔的","baby":0,"size":2,"traits":[]},
					{"desc":"长草的","baby":0,"size":2,"traits":[]},
					{"desc":"多刺的","baby":0,"size":2,"traits":["pain"]},
					{"desc":"雌蕊","baby":_babyType,"size":1,"traits":[]},
					{"desc":"多叶的","baby":0,"size":1,"traits":[]},
					{"desc":"抽枝的","baby":0,"size":1,"traits":[]},
					{"desc":"树苗","baby":0,"size":1,"traits":[]},
				)>>
			<<elseif _args[3] is "metal">>
				<<set _tentacledescs.push(
					{"desc":"抽搐的","baby":0,"size":3,"traits":[]},
					{"desc":"装甲","baby":0,"size":3,"traits":[]},
					{"desc":"冒着火花的","baby":0,"size":2,"traits":["pain"]},
					{"desc":"闪光的","baby":0,"size":2,"traits":[]},
					{"desc":"条纹的","baby":_babyType,"size":2,"traits":[]},
					{"desc":"振动的","baby":0,"size":2,"traits":["pain"]},
					{"desc":"生锈的","baby":0,"size":2,"traits":[]},
					{"desc":"奇怪的","baby":0,"size":1,"traits":["hypno"]},
					{"desc":"不锈钢的","baby":0,"size":1,"traits":[]},
				)>>
			<</if>>
		<</if>>

		<<set _tentacledescs to shuffle(_tentacledescs)>>

		<<for _i to 0; _i lt _args[0]; _i++>>
			<<set _tentacledata to _tentacledescs[_i]>>

			<<set _tentacle to {
				"desc": (_args[3] and (!_args[4] or _args[4] is "desc") ? _args[3] + "" : "" ).replace("pale","苍白色").replace("vine","藤蔓色").replace("metal","金属色") + _tentacledata.desc,
				"fullDesc": (_args[3] and (!_args[4] or _args[4] is "desc") ? _args[3] + "" : "" ).replace("pale","苍白色").replace("vine","藤蔓色").replace("metal","金属色") + _tentacledata.desc + _tentacleType.replace("tentacle","触手").replace("root","树根").replace("shoot","嫩芽").replace("tendril","卷须").replace("vine","藤蔓").replace("metal","金属"),
				"type": _tentacleType,
				"tentaclehealth": _args[1],
				"tentaclehealthstart": _args[1],
				"shaft": 0,
				"head": 0,
				"id": "tentacle"+_i,
				"baby": (_args[3] and (!_args[4] or _args[4] is "baby") and _tentacledata.baby isnot 0 ? _args[3] + " " + _tentacledata.baby : _tentacledata.baby ),
				"babychance": 400,
				"size": _tentacledata.size,
				"traits": _tentacledata.traits
			}>>

			<<set $tentacles[_i] to clone(_tentacle)>>
		<</for>>

	<</if>>
	<<set $combat to 1>>

	<<if $rng gte 51>>
	<<set $position to "missionary">>
	<<else>>
	<<set $position to "doggy">>
	<</if>>
	<<wetnessCalculate>>
	<<resetLastOptions>>
	<<getCombatDefaultsType>>

	<<if !$tentacleColour>>
		<<if $tentacles[0].fullDesc.includes("苍白色")>>
			<<set $tentacleColour to "tentacles-wraith">>
		<<elseif $tentacles[0].fullDesc.includes("金属色")>>
			<<set $tentacleColour to "tentacles-red">>
		<<elseif $tentacles[0].type>>
			<<switch $tentacles[0].type>>
				<<case "vine" "shoot">>
					<<set $tentacleColour to "tentacles-vines">>
				<<case "root">>
					<<set $tentacleColour to "tentacles-roots">>
				<<default>>
					<<set $tentacleColour to "tentacles-purple">>
			<</switch>>
		<<else>>
			<<set $tentacleColour to "tentacles-purple">>
		<</if>>
	<</if>>
<</widget>>

<<widget "tentacles">>
	<div @class="($debugLines ? 'debugLines-tentacles' : '')">
	<<for _i to 0; _i lt $tentacles.max; _i++>>
		<<set _tentacle to $tentacles[_i]>>
		<<if _tentacle isnot undefined>>
			<<tentacleadv _tentacle>>
			<<set _tentacle.tentaclehealth -= 0.2>>
		<</if>>
	<</for>>

	<<if $panicattacks gte 1 and $panicviolence is 0 and $panicparalysis is 0 and $controlled is 0 and _panicchecked isnot true>>
		<<rng>>
		<<if $rng is 100>>
			<<set $panicparalysis to 5>>
		<</if>>
		<<set _panicchecked to true>>
	<</if>>
	<<if $panicattacks gte 2 and $panicviolence is 0 and $panicparalysis is 0 and $controlled is 0 and _paniccheckedviolence isnot true>>
		<<rng>>
		<<if $rng is 100>>
			<<set $panicviolence to 3>>
		<</if>>
		<<set _paniccheckedviolence to true>>
	<</if>>
	<<if $arousal gte $arousalmax and $orgasmdown lte 0>>
		<<orgasm>>
	<</if>>
	<br>
	</div>
<</widget>>

<<widget "effectstentacles">>
	<<effectspain>>
	<<effectsorgasm>>
	<<effectsdissociation>>

	<div @class="($debugLines ? 'debugLines-effectstentacleadv' : '')">
		<<for _i to 0; _i lt $tentacles.max; _i++>>
			<<if $tentacles[_i] isnot undefined>>
				<<set _tentacle to $tentacles[_i]>>
				<<effectstentacleadv _tentacle>>
			<</if>>
		<</for>>
	</div>

	<br>
<</widget>>

<<widget "actionstentacles">>
	<div @class="($debugLines ? 'debugLines-actionstentacles' : '')">
		<<set $enemyarousal to $arousal>>
		<<if $vorecreature is 0 and _swarmcreature is undefined>>
			<<if $options.images is 1 and $options.combatImages is 1>>
				<<timed 100ms>>
					<br>
					<<combatimg>>
					<br>
				<</timed>>
			<</if>>
		<</if>>
		<<willpowerpain>>
		<<willpowerorgasm>>
		<<actioncarry>>
		<<actioncarrydrop>>

		<<combatstate>>
		<<carryblock>>

		<<if $trance lte 0 and $panicparalysis is 0 and $panicviolence is 0>>
			<<generateActionsTentacle>>
		<</if>>

	</div>
	<br><br>
<</widget>>

<<widget "actionstentaclespenis">> /* unused */
	<<for _i to 0; _i lt $tentacles.max; _i++>>
		<<if $tentacles[_i] isnot undefined>>
			<<set _tentacle to $tentacles[_i]>>
			<<actionstentacleadvpenis _tentacle>>
		<</if>>
	<</for>>
	<br>
<</widget>>

<<widget "actionstentacleslegs">> /* unused */
	<<for _i to 0; _i lt $tentacles.max; _i++>>
		<<if $tentacles[_i] isnot undefined>>
			<<set _tentacle to $tentacles[_i]>>
			<<actionstentacleadvlegs _tentacle>>
		<</if>>
	<</for>>
<</widget>>

<<widget "actionstentaclesrighthand">> /* unused */
	<<for _i to 0; _i lt $tentacles.max; _i++>>
		<<if $tentacles[_i] isnot undefined>>
			<<set _tentacle to $tentacles[_i]>>
			<<actionstentacleadvrighthand _tentacle>>
		<</if>>
	<</for>>
<</widget>>

<<widget "actionstentacleslefthand">> /* unused */
	<<for _i to 0; _i lt $tentacles.max; _i++>>
		<<if $tentacles[_i] isnot undefined>>
			<<set _tentacle to $tentacles[_i]>>
			<<actionstentacleadvlefthand _tentacle>>
		<</if>>
	<</for>>
<</widget>>

<<widget "upperslither">>
	<<if $worn.over_upper.name isnot "naked">>
		然后在你的$worn.over_upper.cn_name_cap<<if $worn.upper.name isnot "naked">>和$worn.upper.cn_name_cap<</if>>下方<<slithers>>
	<<elseif $worn.upper.name isnot "naked">>
		然后在你的$worn.upper.cn_name_cap下方<<slithers>>
	<<else>>
		然后慢慢<<slithers>>你裸露在外的细嫩皮肤
	<</if>>
<</widget>>

<<widget "lowerslither">>
	<<if $worn.over_lower.name isnot "naked">>
		然后在你的$worn.over_lower.cn_name_cap<<if $worn.lower.name isnot "naked">>和$worn.lower.cn_name_cap<</if>>下方<<slithers>>
	<<elseif $worn.lower.name isnot "naked">>
		然后在你的$worn.lower.cn_name_cap下方<<slithers>>
	<<else>>
		然后慢慢<<slithers>>你裸露在外的细嫩皮肤
	<</if>>
<</widget>>

<<widget "underslither">>
	<<if $worn.lower.name isnot "naked">>
		<<if !$worn.under_lower.type.includes("naked")>>
			然后在你的$worn.lower.cn_name_cap和$worn.under_lower.cn_name_cap下方<<slithers>>
		<<elseif playerChastity()>>
			然后在你的$worn.lower.cn_name_cap下方<<slithers>>，紧贴着你的<<print $worn.genitals.cn_name_cap>>。
		<<else>>
		<</if>>
	<<else>>
		<<if !$worn.under_lower.type.includes("naked")>>
			然后在你的$worn.under_lower.cn_name_cap下方<<slithers>>
			<<if playerChastity("hidden")>>
				紧贴着你的<<print $worn.genitals.cn_name_cap>>。
			<</if>>
		<<elseif $worn.under_lower.type.includes("naked") and playerChastity("hidden")>>
			然后<<slithers>>在你的<<print $worn.genitals.cn_name_cap>>上面。
		<<else>>
			然后慢慢<<slithers>>你裸露在外的细嫩皮肤
		<</if>>
	<</if>>
<</widget>>

<<widget "statetentacles">>
	<<for _j to 0; _j lt $tentacles.max; _j++>>
		<<if $tentacles[_j] isnot undefined>>
			<<if $tentacles[_j].shaft is "finished" and $tentacles[_j].name isnot "finished">>
				<<set $tentacles.active -= 1>>
				<<set $tentacles[_j].name to "finished">>
			<</if>>
		<</if>>
	<</for>>
<<sexcheck>>
<<if $ejaculating isnot 1>>
	你看到周围有<<number $tentacles.active>>条<<print $tentacles[0].type.replace("tentacle","触手").replace("root","树根").replace("shoot","嫩芽").replace("tendril","卷须").replace("vine","藤蔓").replace("metal","金属")>><<if $tentacles.active isnot 1>><</if>>。
	<br><br><br>
<</if>>
<</widget>>

<<widget "leftarmtentacledisable">>
	<<for _j to 0; _j lt $tentacles.max; _j++>>
		<<if $tentacles[_j] isnot undefined>>
			<<if $tentacles[_j].id is $leftarm>>
				<<set $tentacles[_j].head to 0>>
			<</if>>
		<</if>>
	<</for>>
<</widget>>

<<widget "rightarmtentacledisable">>
	<<for _j to 0; _j lt $tentacles.max; _j++>>
		<<if $tentacles[_j] isnot undefined>>
			<<if $tentacles[_j].id is $rightarm>>
				<<set $tentacles[_j].head to 0>>
			<</if>>
		<</if>>
	<</for>>
<</widget>>

<<widget "feettentacledisable">>
	<<for _j to 0; _j lt $tentacles.max; _j++>>
		<<if $tentacles[_j] isnot undefined>>
			<<if $tentacles[_j].id is $feetuse>>
				<<set $tentacles[_j].head to 0>>
			<</if>>
		<</if>>
	<</for>>
<</widget>>